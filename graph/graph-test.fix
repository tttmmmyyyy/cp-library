module CPLib.Graph.Test;

import CPLib.Graph;

test : IO ();
test = (
    test_dijkstra;;
    test_scc;;
    pure()
);

test_dijkstra : IO ();
test_dijkstra = (
    let graph = Graph::create(6);
    let graph = graph.add_edge(0, 1, 10);
    let graph = graph.add_edge(0, 2, 3);
    let graph = graph.add_edge(1, 3, 2);
    let graph = graph.add_edge(2, 1, 4);
    let graph = graph.add_edge(2, 3, 8);
    let graph = graph.add_edge(2, 4, 2);
    let graph = graph.add_edge(3, 4, 5);
    let dist = graph.dijkstra(0, I64::maximum);
    assert_eq(|_|"", dist, [0, 7, 3, 9, 5, I64::maximum])
);

test_scc : IO ();
test_scc = (
    test_scc_basic;;
    pure()
);

test_scc_basic : IO ();
test_scc_basic = (
    // 頂点数 = 13,
    //                 {4, 5, 6}
    //                   ↑
    // {10, 11, 12} -> {0, 1} -> {2, 3}
    //                   ↓         ↑
    //                  {7}   ->
    //
    // {8} -> {9}
    // 

    let graph = Graph::create(13);

    // {10, 11, 12}
    let graph = graph.add_edge(11, 10, ());
    let graph = graph.add_edge(10, 12, ());
    let graph = graph.add_edge(12, 11, ());

    // {0, 1}
    let graph = graph.add_edge(0, 1, ());
    let graph = graph.add_edge(1, 0, ());

    // {2, 3}
    let graph = graph.add_edge(3, 2, ()); 
    let graph = graph.add_edge(2, 3, ());

    // {4, 5, 6}
    let graph = graph.add_edge(4, 5, ());
    let graph = graph.add_edge(5, 6, ());
    let graph = graph.add_edge(6, 4, ());

    // {10, 11, 12} -> {0, 1}
    let graph = graph.add_edge(12, 0, ());

    // {0, 1} -> {2, 3}
    let graph = graph.add_edge(1, 2, ());

    // {0, 1} -> {4, 5, 6}
    let graph = graph.add_edge(1, 4, ());

    // {7} -> {2, 3}
    let graph = graph.add_edge(7, 2, ());

    // {8} -> {9}
    let graph = graph.add_edge(8, 9, ());

    let sccs = graph.compute_sccs;
    sccs.to_string.println;;

    pure()
);